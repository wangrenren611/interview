# 01-å¼€å‘ç¯å¢ƒä¸é¡¹ç›®åˆå§‹åŒ–

## 1. å¼€å‘ç¯å¢ƒæ­å»º

### 1.1 åŸºç¡€ç¯å¢ƒè¦æ±‚

#### 1.1.1 Node.jsç¯å¢ƒé…ç½®

**æ¨èç‰ˆæœ¬ï¼šNode.js 18.x LTSæˆ–20.x LTS**

```bash
# æŸ¥çœ‹å½“å‰Node.jsç‰ˆæœ¬
node --version

# æŸ¥çœ‹npmç‰ˆæœ¬
npm --version

# ä½¿ç”¨nvmç®¡ç†Node.jsç‰ˆæœ¬ï¼ˆæ¨èï¼‰
curl -o- https://raw.githubusercontent.com/nvm-sh/nvm/v0.39.0/install.sh | bash

# å®‰è£…å¹¶ä½¿ç”¨Node.js 18 LTS
nvm install 18
nvm use 18
nvm alias default 18
```

#### 1.1.2 æ•°æ®åº“ç¯å¢ƒé…ç½®

**MySQL 8.0å®‰è£…é…ç½®**

```bash
# macOSä½¿ç”¨Homebrewå®‰è£…
brew install mysql@8.0
brew services start mysql@8.0

# åˆ›å»ºæ•°æ®åº“
mysql -u root -p
CREATE DATABASE ecommerce_dev CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;
CREATE DATABASE ecommerce_test CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;

# åˆ›å»ºä¸“ç”¨ç”¨æˆ·
CREATE USER 'ecommerce_user'@'localhost' IDENTIFIED BY 'secure_password_123';
GRANT ALL PRIVILEGES ON ecommerce_dev.* TO 'ecommerce_user'@'localhost';
GRANT ALL PRIVILEGES ON ecommerce_test.* TO 'ecommerce_user'@'localhost';
FLUSH PRIVILEGES;
```

**Rediså®‰è£…é…ç½®**

```bash
# macOSä½¿ç”¨Homebrewå®‰è£…
brew install redis
brew services start redis

# æµ‹è¯•Redisè¿æ¥
redis-cli ping
# æœŸæœ›è¾“å‡º: PONG
```

### 1.2 Dockerç¯å¢ƒé…ç½®

#### 1.2.1 å¼€å‘ç¯å¢ƒDockeré…ç½®

**docker-compose.dev.yml**

```yaml
version: '3.8'

services:
  # MySQLæ•°æ®åº“
  mysql:
    image: mysql:8.0
    container_name: ecommerce_mysql_dev
    restart: unless-stopped
    environment:
      MYSQL_ROOT_PASSWORD: root_password_123
      MYSQL_DATABASE: ecommerce_dev
      MYSQL_USER: ecommerce_user
      MYSQL_PASSWORD: secure_password_123
    ports:
      - "3306:3306"
    volumes:
      - mysql_data:/var/lib/mysql
      - ./docker/mysql/conf.d:/etc/mysql/conf.d
    command: --default-authentication-plugin=mysql_native_password

  # Redisç¼“å­˜
  redis:
    image: redis:7.0-alpine
    container_name: ecommerce_redis_dev
    restart: unless-stopped
    ports:
      - "6379:6379"
    volumes:
      - redis_data:/data
    command: redis-server --requirepass redis_password_123

  # phpMyAdminï¼ˆå¯é€‰ï¼‰
  phpmyadmin:
    image: phpmyadmin/phpmyadmin
    container_name: ecommerce_phpmyadmin_dev
    restart: unless-stopped
    environment:
      PMA_HOST: mysql
      PMA_PORT: 3306
      PMA_USER: root
      PMA_PASSWORD: root_password_123
    ports:
      - "8080:80"
    depends_on:
      - mysql

volumes:
  mysql_data:
  redis_data:
```

**å¯åŠ¨å¼€å‘ç¯å¢ƒï¼š**

```bash
# å¯åŠ¨æ‰€æœ‰æœåŠ¡
docker-compose -f docker-compose.dev.yml up -d

# æŸ¥çœ‹æœåŠ¡çŠ¶æ€
docker-compose -f docker-compose.dev.yml ps

# åœæ­¢æ‰€æœ‰æœåŠ¡
docker-compose -f docker-compose.dev.yml down
```

## 2. é¡¹ç›®åˆå§‹åŒ–

### 2.1 é¡¹ç›®ç»“æ„è®¾è®¡

#### 2.1.1 ä¼ä¸šçº§é¡¹ç›®ç›®å½•ç»“æ„

```
ecommerce-koa-api/
â”œâ”€â”€ src/                          # æºä»£ç ç›®å½•
â”‚   â”œâ”€â”€ app/                      # åº”ç”¨æ ¸å¿ƒ
â”‚   â”‚   â”œâ”€â”€ controllers/          # æ§åˆ¶å™¨å±‚
â”‚   â”‚   â”‚   â”œâ”€â”€ auth/            # è®¤è¯ç›¸å…³æ§åˆ¶å™¨
â”‚   â”‚   â”‚   â”œâ”€â”€ user/            # ç”¨æˆ·ç›¸å…³æ§åˆ¶å™¨
â”‚   â”‚   â”‚   â”œâ”€â”€ product/         # å•†å“ç›¸å…³æ§åˆ¶å™¨
â”‚   â”‚   â”‚   â””â”€â”€ order/           # è®¢å•ç›¸å…³æ§åˆ¶å™¨
â”‚   â”‚   â”œâ”€â”€ services/            # ä¸šåŠ¡é€»è¾‘å±‚
â”‚   â”‚   â”‚   â”œâ”€â”€ auth.service.js
â”‚   â”‚   â”‚   â”œâ”€â”€ user.service.js
â”‚   â”‚   â”‚   â”œâ”€â”€ product.service.js
â”‚   â”‚   â”‚   â””â”€â”€ order.service.js
â”‚   â”‚   â”œâ”€â”€ models/              # æ•°æ®æ¨¡å‹å±‚
â”‚   â”‚   â”‚   â”œâ”€â”€ user.model.js
â”‚   â”‚   â”‚   â”œâ”€â”€ product.model.js
â”‚   â”‚   â”‚   â””â”€â”€ order.model.js
â”‚   â”‚   â”œâ”€â”€ repositories/        # æ•°æ®è®¿é—®å±‚
â”‚   â”‚   â”‚   â”œâ”€â”€ base.repository.js
â”‚   â”‚   â”‚   â”œâ”€â”€ user.repository.js
â”‚   â”‚   â”‚   â””â”€â”€ product.repository.js
â”‚   â”‚   â””â”€â”€ validators/          # æ•°æ®éªŒè¯
â”‚   â”‚       â”œâ”€â”€ auth.validator.js
â”‚   â”‚       â””â”€â”€ user.validator.js
â”‚   â”œâ”€â”€ config/                  # é…ç½®æ–‡ä»¶
â”‚   â”‚   â”œâ”€â”€ database.js          # æ•°æ®åº“é…ç½®
â”‚   â”‚   â”œâ”€â”€ redis.js             # Redisé…ç½®
â”‚   â”‚   â”œâ”€â”€ jwt.js               # JWTé…ç½®
â”‚   â”‚   â””â”€â”€ index.js             # é…ç½®å…¥å£
â”‚   â”œâ”€â”€ middleware/              # ä¸­é—´ä»¶
â”‚   â”‚   â”œâ”€â”€ auth.middleware.js   # è®¤è¯ä¸­é—´ä»¶
â”‚   â”‚   â”œâ”€â”€ cors.middleware.js   # è·¨åŸŸä¸­é—´ä»¶
â”‚   â”‚   â”œâ”€â”€ error.middleware.js  # é”™è¯¯å¤„ç†ä¸­é—´ä»¶
â”‚   â”‚   â””â”€â”€ logger.middleware.js # æ—¥å¿—ä¸­é—´ä»¶
â”‚   â”œâ”€â”€ routes/                  # è·¯ç”±å®šä¹‰
â”‚   â”‚   â”œâ”€â”€ auth.routes.js       # è®¤è¯è·¯ç”±
â”‚   â”‚   â”œâ”€â”€ user.routes.js       # ç”¨æˆ·è·¯ç”±
â”‚   â”‚   â”œâ”€â”€ product.routes.js    # å•†å“è·¯ç”±
â”‚   â”‚   â””â”€â”€ index.js             # è·¯ç”±å…¥å£
â”‚   â”œâ”€â”€ utils/                   # å·¥å…·å‡½æ•°
â”‚   â”‚   â”œâ”€â”€ crypto.js            # åŠ å¯†å·¥å…·
â”‚   â”‚   â”œâ”€â”€ response.js          # å“åº”å·¥å…·
â”‚   â”‚   â””â”€â”€ validation.js        # éªŒè¯å·¥å…·
â”‚   â”œâ”€â”€ constants/               # å¸¸é‡å®šä¹‰
â”‚   â”‚   â”œâ”€â”€ error-codes.js       # é”™è¯¯ç å®šä¹‰
â”‚   â”‚   â””â”€â”€ user-roles.js        # ç”¨æˆ·è§’è‰²å®šä¹‰
â”‚   â”œâ”€â”€ database/                # æ•°æ®åº“ç›¸å…³
â”‚   â”‚   â”œâ”€â”€ migrations/          # æ•°æ®åº“è¿ç§»
â”‚   â”‚   â””â”€â”€ seeders/             # æ•°æ®å¡«å……
â”‚   â””â”€â”€ app.js                   # åº”ç”¨å…¥å£
â”œâ”€â”€ tests/                       # æµ‹è¯•æ–‡ä»¶
â”‚   â”œâ”€â”€ unit/                    # å•å…ƒæµ‹è¯•
â”‚   â”œâ”€â”€ integration/             # é›†æˆæµ‹è¯•
â”‚   â””â”€â”€ fixtures/                # æµ‹è¯•æ•°æ®
â”œâ”€â”€ docs/                        # æ–‡æ¡£ç›®å½•
â”œâ”€â”€ scripts/                     # è„šæœ¬æ–‡ä»¶
â”œâ”€â”€ docker/                      # Dockeré…ç½®
â”œâ”€â”€ .env.example                 # ç¯å¢ƒå˜é‡ç¤ºä¾‹
â”œâ”€â”€ .gitignore                   # Gitå¿½ç•¥æ–‡ä»¶
â”œâ”€â”€ .eslintrc.js                 # ESLinté…ç½®
â”œâ”€â”€ package.json                 # é¡¹ç›®ä¾èµ–
â””â”€â”€ server.js                    # æœåŠ¡å™¨å¯åŠ¨æ–‡ä»¶
```

### 2.2 ä¾èµ–åŒ…å®‰è£…ä¸é…ç½®

#### 2.2.1 æ ¸å¿ƒä¾èµ–å®‰è£…

```bash
# Koaæ ¸å¿ƒæ¡†æ¶
npm install koa koa-router koa-bodyparser koa-cors koa-helmet

# æ•°æ®åº“ç›¸å…³
npm install sequelize mysql2 redis ioredis

# è®¤è¯å’Œå®‰å…¨
npm install jsonwebtoken bcryptjs passport passport-jwt

# æ•°æ®éªŒè¯
npm install joi

# æ—¥å¿—ç³»ç»Ÿ
npm install winston morgan

# å·¥å…·åº“
npm install lodash moment uuid dotenv

# æ–‡ä»¶ä¸Šä¼ 
npm install multer @koa/multer

# APIæ–‡æ¡£
npm install swagger-jsdoc swagger-ui-koa
```

#### 2.2.2 å¼€å‘ä¾èµ–å®‰è£…

```bash
# æµ‹è¯•æ¡†æ¶
npm install --save-dev jest supertest

# ä»£ç è§„èŒƒ
npm install --save-dev eslint prettier eslint-config-prettier eslint-plugin-prettier

# å¼€å‘å·¥å…·
npm install --save-dev nodemon cross-env

# æ•°æ®åº“è¿ç§»å·¥å…·
npm install --save-dev sequelize-cli
```

#### 2.2.3 package.jsoné…ç½®

```json
{
  "name": "ecommerce-koa-api",
  "version": "1.0.0",
  "description": "ä¼ä¸šçº§ç”µå•†APIç³»ç»Ÿ",
  "main": "server.js",
  "scripts": {
    "start": "node server.js",
    "dev": "cross-env NODE_ENV=development nodemon server.js",
    "test": "cross-env NODE_ENV=test jest",
    "test:watch": "cross-env NODE_ENV=test jest --watch",
    "test:coverage": "cross-env NODE_ENV=test jest --coverage",
    "lint": "eslint src/**/*.js",
    "lint:fix": "eslint src/**/*.js --fix",
    "format": "prettier --write src/**/*.js",
    "db:migrate": "sequelize-cli db:migrate",
    "db:seed": "sequelize-cli db:seed:all",
    "db:reset": "npm run db:migrate:undo && npm run db:migrate && npm run db:seed",
    "docker:dev": "docker-compose -f docker-compose.dev.yml up -d",
    "docker:dev:stop": "docker-compose -f docker-compose.dev.yml down"
  },
  "keywords": [
    "nodejs",
    "koa",
    "ecommerce",
    "api",
    "enterprise"
  ],
  "engines": {
    "node": ">=18.0.0",
    "npm": ">=8.0.0"
  }
}
```

### 2.3 ç¯å¢ƒé…ç½®ç®¡ç†

#### 2.3.1 ç¯å¢ƒå˜é‡é…ç½®

**.env.exampleï¼ˆç¯å¢ƒå˜é‡æ¨¡æ¿ï¼‰**

```bash
# åº”ç”¨é…ç½®
NODE_ENV=development
PORT=3000
APP_NAME=ECommerce API
APP_VERSION=1.0.0

# æ•°æ®åº“é…ç½®
DB_HOST=localhost
DB_PORT=3306
DB_NAME=ecommerce_dev
DB_USER=ecommerce_user
DB_PASSWORD=secure_password_123
DB_TIMEZONE=+08:00

# Redisé…ç½®
REDIS_HOST=localhost
REDIS_PORT=6379
REDIS_PASSWORD=redis_password_123
REDIS_DB=0

# JWTé…ç½®
JWT_SECRET=your_super_secret_jwt_key_here_change_in_production
JWT_EXPIRES_IN=7d
JWT_REFRESH_SECRET=your_refresh_token_secret_key
JWT_REFRESH_EXPIRES_IN=30d

# é‚®ä»¶é…ç½®
MAIL_HOST=smtp.gmail.com
MAIL_PORT=587
MAIL_USER=your-email@gmail.com
MAIL_PASSWORD=your-app-password
MAIL_FROM=noreply@yourapp.com

# æ–‡ä»¶ä¸Šä¼ é…ç½®
UPLOAD_PATH=uploads
MAX_FILE_SIZE=5242880
ALLOWED_FILE_TYPES=jpg,jpeg,png,gif,pdf

# æ—¥å¿—é…ç½®
LOG_LEVEL=debug
LOG_FILE=logs/app.log

# é™æµé…ç½®
RATE_LIMIT_WINDOW=15
RATE_LIMIT_MAX_REQUESTS=100
```

#### 2.3.2 é…ç½®æ–‡ä»¶ç®¡ç†

**src/config/index.jsï¼ˆé…ç½®ç®¡ç†å…¥å£ï¼‰**

```javascript
const dotenv = require('dotenv');
const path = require('path');

// æ ¹æ®ç¯å¢ƒåŠ è½½ä¸åŒçš„é…ç½®æ–‡ä»¶
const envFile = `.env.${process.env.NODE_ENV || 'development'}`;
const envPath = path.resolve(process.cwd(), envFile);

// åŠ è½½ç¯å¢ƒå˜é‡
dotenv.config({ path: envPath });

// å¦‚æœç¯å¢ƒç‰¹å®šçš„é…ç½®æ–‡ä»¶ä¸å­˜åœ¨ï¼ŒåŠ è½½é»˜è®¤é…ç½®
if (!require('fs').existsSync(envPath)) {
  dotenv.config({ path: path.resolve(process.cwd(), '.env') });
}

const config = {
  // åº”ç”¨é…ç½®
  app: {
    name: process.env.APP_NAME || 'ECommerce API',
    version: process.env.APP_VERSION || '1.0.0',
    port: parseInt(process.env.PORT) || 3000,
    env: process.env.NODE_ENV || 'development',
    isDevelopment: process.env.NODE_ENV === 'development',
    isProduction: process.env.NODE_ENV === 'production',
    isTest: process.env.NODE_ENV === 'test'
  },
  
  // æ•°æ®åº“é…ç½®
  database: {
    host: process.env.DB_HOST || 'localhost',
    port: parseInt(process.env.DB_PORT) || 3306,
    database: process.env.DB_NAME,
    username: process.env.DB_USER,
    password: process.env.DB_PASSWORD,
    dialect: 'mysql',
    timezone: process.env.DB_TIMEZONE || '+08:00',
    logging: process.env.NODE_ENV === 'development' ? console.log : false,
    pool: {
      max: 20,
      min: 5,
      acquire: 30000,
      idle: 10000
    }
  },
  
  // Redisé…ç½®
  redis: {
    host: process.env.REDIS_HOST || 'localhost',
    port: parseInt(process.env.REDIS_PORT) || 6379,
    password: process.env.REDIS_PASSWORD,
    db: parseInt(process.env.REDIS_DB) || 0
  },
  
  // JWTé…ç½®
  jwt: {
    secret: process.env.JWT_SECRET,
    expiresIn: process.env.JWT_EXPIRES_IN || '7d',
    refreshSecret: process.env.JWT_REFRESH_SECRET,
    refreshExpiresIn: process.env.JWT_REFRESH_EXPIRES_IN || '30d'
  }
};

// éªŒè¯å¿…éœ€çš„é…ç½®é¡¹
const requiredConfigs = [
  'database.database',
  'database.username', 
  'database.password',
  'jwt.secret'
];

for (const configPath of requiredConfigs) {
  const value = configPath.split('.').reduce((obj, key) => obj && obj[key], config);
  if (!value) {
    throw new Error(`Missing required configuration: ${configPath}`);
  }
}

module.exports = config;
```

### 2.4 ä»£ç è§„èŒƒé…ç½®

#### 2.4.1 ESLinté…ç½®

**.eslintrc.js**

```javascript
module.exports = {
  env: {
    browser: false,
    es2021: true,
    node: true,
    jest: true
  },
  extends: [
    'eslint:recommended',
    'prettier'
  ],
  plugins: [
    'prettier'
  ],
  parserOptions: {
    ecmaVersion: 2021,
    sourceType: 'module'
  },
  rules: {
    'prettier/prettier': 'error',
    'no-console': process.env.NODE_ENV === 'production' ? 'warn' : 'off',
    'no-debugger': process.env.NODE_ENV === 'production' ? 'warn' : 'off',
    'no-unused-vars': ['error', { argsIgnorePattern: '^_' }],
    'no-var': 'error',
    'prefer-const': 'error',
    'require-await': 'error',
    'no-return-await': 'error'
  }
};
```

#### 2.4.2 Prettieré…ç½®

**.prettierrc**

```json
{
  "semi": true,
  "singleQuote": true,
  "tabWidth": 2,
  "trailingComma": "es5",
  "printWidth": 100,
  "bracketSpacing": true,
  "arrowParens": "avoid"
}
```

#### 2.4.3 Gité…ç½®

**.gitignore**

```bash
# ä¾èµ–åŒ…
node_modules/

# ç¯å¢ƒé…ç½®
.env
.env.local
.env.production

# æ—¥å¿—æ–‡ä»¶
logs/
*.log

# ä¸Šä¼ æ–‡ä»¶
uploads/

# æµ‹è¯•è¦†ç›–ç‡
coverage/

# ç¼“å­˜æ–‡ä»¶
.cache/

# ç¼–è¾‘å™¨é…ç½®
.vscode/
.idea/

# æ“ä½œç³»ç»Ÿæ–‡ä»¶
.DS_Store

# Dockerç›¸å…³
docker-compose.override.yml
```

### 2.5 åŸºç¡€åº”ç”¨æ­å»º

#### 2.5.1 åº”ç”¨å…¥å£æ–‡ä»¶

**server.jsï¼ˆæœåŠ¡å™¨å¯åŠ¨æ–‡ä»¶ï¼‰**

```javascript
const config = require('./src/config');
const app = require('./src/app');

// å¯åŠ¨æœåŠ¡å™¨
const server = app.listen(config.app.port, () => {
  console.log(`ğŸš€ ${config.app.name} v${config.app.version} started successfully!`);
  console.log(`ğŸ“Š Environment: ${config.app.env}`);
  console.log(`ğŸŒ Server running on port ${config.app.port}`);
  console.log(`ğŸ“– API Documentation: http://localhost:${config.app.port}/api-docs`);
  
  if (config.app.isDevelopment) {
    console.log(`ğŸ”§ Development mode enabled`);
  }
});

// ä¼˜é›…å…³é—­
process.on('SIGTERM', () => {
  console.log('ğŸ›‘ SIGTERM received, shutting down gracefully');
  server.close(() => {
    console.log('âœ… Process terminated');
    process.exit(0);
  });
});

process.on('SIGINT', () => {
  console.log('ğŸ›‘ SIGINT received, shutting down gracefully'); 
  server.close(() => {
    console.log('âœ… Process terminated');
    process.exit(0);
  });
});

module.exports = server;
```

**src/app.jsï¼ˆåº”ç”¨æ ¸å¿ƒæ–‡ä»¶ï¼‰**

```javascript
const Koa = require('koa');
const bodyParser = require('koa-bodyparser');
const cors = require('@koa/cors');
const helmet = require('koa-helmet');

const config = require('./config');
const routes = require('./routes');

// åˆ›å»ºKoaåº”ç”¨å®ä¾‹
const app = new Koa();

// åº”ç”¨çº§åˆ«é”™è¯¯å¤„ç†
app.on('error', (err, ctx) => {
  console.error('Application error:', err);
  
  if (ctx) {
    console.error(`Request: ${ctx.method} ${ctx.url}`);
    console.error(`User: ${ctx.user ? ctx.user.id : 'Anonymous'}`);
  }
});

// å®‰å…¨ä¸­é—´ä»¶
app.use(helmet());

// CORSé…ç½®
app.use(cors({
  origin: config.app.isDevelopment ? '*' : 'https://yourdomain.com',
  allowMethods: ['GET', 'POST', 'PUT', 'DELETE', 'OPTIONS'],
  allowHeaders: ['Content-Type', 'Authorization', 'X-Requested-With'],
  credentials: true
}));

// è¯·æ±‚ä½“è§£æ
app.use(bodyParser({
  jsonLimit: '10mb',
  formLimit: '10mb',
  textLimit: '10mb'
}));

// é”™è¯¯å¤„ç†ä¸­é—´ä»¶
app.use(async (ctx, next) => {
  try {
    await next();
  } catch (error) {
    ctx.status = error.status || 500;
    ctx.body = {
      success: false,
      message: error.message || 'Internal Server Error',
      ...(config.app.isDevelopment && { stack: error.stack })
    };
    
    // è§¦å‘åº”ç”¨çº§é”™è¯¯äº‹ä»¶
    app.emit('error', error, ctx);
  }
});

// è¯·æ±‚æ—¥å¿—ä¸­é—´ä»¶
app.use(async (ctx, next) => {
  const start = Date.now();
  await next();
  const duration = Date.now() - start;
  
  console.log(`${ctx.method} ${ctx.url} - ${ctx.status} - ${duration}ms`);
});

// æ³¨å†Œè·¯ç”±
app.use(routes.routes());
app.use(routes.allowedMethods());

// å¥åº·æ£€æŸ¥ç«¯ç‚¹
app.use(async (ctx, next) => {
  if (ctx.path === '/health') {
    ctx.status = 200;
    ctx.body = {
      status: 'OK',
      timestamp: new Date().toISOString(),
      version: config.app.version
    };
    return;
  }
  await next();
});

// 404å¤„ç†
app.use(async (ctx) => {
  ctx.status = 404;
  ctx.body = {
    success: false,
    message: 'API endpoint not found',
    path: ctx.path
  };
});

module.exports = app;
```

### 2.6 é¡¹ç›®åˆå§‹åŒ–è„šæœ¬

#### 2.6.1 é¡¹ç›®å¿«é€Ÿåˆå§‹åŒ–

**scripts/init-project.js**

```javascript
const fs = require('fs');
const path = require('path');

// åˆ›å»ºç›®å½•ç»“æ„
const directories = [
  'src/app/controllers/auth',
  'src/app/controllers/user', 
  'src/app/controllers/product',
  'src/app/controllers/order',
  'src/app/services',
  'src/app/models',
  'src/app/repositories',
  'src/app/validators',
  'src/config',
  'src/middleware',
  'src/routes',
  'src/utils',
  'src/constants',
  'src/database/migrations',
  'src/database/seeders',
  'tests/unit',
  'tests/integration',
  'tests/fixtures',
  'docs/api',
  'scripts',
  'docker/mysql/conf.d',
  'docker/redis',
  'logs',
  'uploads'
];

console.log('ğŸ“ Creating directory structure...');

directories.forEach(dir => {
  const fullPath = path.join(process.cwd(), dir);
  if (!fs.existsSync(fullPath)) {
    fs.mkdirSync(fullPath, { recursive: true });
    console.log(`âœ… Created: ${dir}`);
  }
});

// åˆ›å»ºåŸºç¡€æ–‡ä»¶
const files = [
  'src/routes/index.js',
  'src/constants/error-codes.js',
  'src/constants/user-roles.js',
  'src/utils/response.js',
  'logs/.gitkeep',
  'uploads/.gitkeep'
];

files.forEach(file => {
  const fullPath = path.join(process.cwd(), file);
  if (!fs.existsSync(fullPath)) {
    fs.writeFileSync(fullPath, '');
    console.log(`âœ… Created: ${file}`);
  }
});

console.log('ğŸ‰ Project structure initialized successfully!');
```

#### 2.6.2 è¿è¡Œåˆå§‹åŒ–

```bash
# åˆ›å»ºé¡¹ç›®ç›®å½•
mkdir ecommerce-koa-api
cd ecommerce-koa-api

# åˆå§‹åŒ–npmé¡¹ç›®
npm init -y

# è¿è¡Œé¡¹ç›®åˆå§‹åŒ–è„šæœ¬
node scripts/init-project.js

# å®‰è£…ä¾èµ–
npm install

# å¤åˆ¶ç¯å¢ƒå˜é‡é…ç½®
cp .env.example .env

# å¯åŠ¨å¼€å‘ç¯å¢ƒ
npm run docker:dev
npm run dev
```

## 3. å¼€å‘å·¥ä½œæµç¨‹

### 3.1 æ—¥å¸¸å¼€å‘æµç¨‹

```mermaid
graph TB
    A[æ‹‰å–æœ€æ–°ä»£ç ] --> B[åˆ›å»ºåŠŸèƒ½åˆ†æ”¯]
    B --> C[å¼€å‘åŠŸèƒ½]
    C --> D[è¿è¡Œæµ‹è¯•]
    D --> E{æµ‹è¯•é€šè¿‡?}
    E -->|å¦| C
    E -->|æ˜¯| F[ä»£ç æ£€æŸ¥]
    F --> G[æäº¤ä»£ç ]
    G --> H[æ¨é€åˆ†æ”¯]
    H --> I[åˆ›å»ºPR]
    I --> J[ä»£ç å®¡æŸ¥]
    J --> K[åˆå¹¶ä¸»åˆ†æ”¯]
```

### 3.2 Gitå·¥ä½œæµè§„èŒƒ

```bash
# 1. æ‹‰å–æœ€æ–°ä»£ç 
git pull origin main

# 2. åˆ›å»ºåŠŸèƒ½åˆ†æ”¯
git checkout -b feature/user-authentication

# 3. å¼€å‘å¹¶æäº¤
git add .
git commit -m "feat: implement user authentication"

# 4. æ¨é€åˆ†æ”¯
git push origin feature/user-authentication

# 5. åˆ›å»ºPull Request
# é€šè¿‡Gitå¹³å°åˆ›å»ºPR

# 6. åˆå¹¶åæ¸…ç†
git checkout main
git pull origin main
git branch -d feature/user-authentication
```

### 3.3 æäº¤ä¿¡æ¯è§„èŒƒ

```bash
# æ ¼å¼: <type>(<scope>): <description>

# ç±»å‹è¯´æ˜:
feat:     æ–°åŠŸèƒ½
fix:      ä¿®å¤bug
docs:     æ–‡æ¡£æ›´æ–°
style:    ä»£ç æ ¼å¼åŒ–
refactor: é‡æ„ä»£ç 
test:     æ·»åŠ æµ‹è¯•
chore:    æ„å»ºå·¥å…·æˆ–è¾…åŠ©å·¥å…·çš„å˜åŠ¨

# ç¤ºä¾‹:
git commit -m "feat(auth): add JWT authentication middleware"
git commit -m "fix(user): resolve user registration validation issue"
git commit -m "docs(api): update user API documentation"
```

## 4. æ€»ç»“

æœ¬æ–‡æ¡£è¯¦ç»†ä»‹ç»äº†ä¼ä¸šçº§Node.js+Koa2ç”µå•†é¡¹ç›®çš„å¼€å‘ç¯å¢ƒæ­å»ºå’Œé¡¹ç›®åˆå§‹åŒ–è¿‡ç¨‹ã€‚é€šè¿‡æ ‡å‡†åŒ–çš„é¡¹ç›®ç»“æ„ã€å®Œå–„çš„é…ç½®ç®¡ç†å’Œè§„èŒƒçš„å¼€å‘æµç¨‹ï¼Œä¸ºåç»­çš„åŠŸèƒ½å¼€å‘å¥ å®šäº†åšå®çš„åŸºç¡€ã€‚

### 4.1 å…³é”®è¦ç‚¹

1. **æ ‡å‡†åŒ–é¡¹ç›®ç»“æ„**ï¼šæ¸…æ™°çš„åˆ†å±‚æ¶æ„å’Œæ¨¡å—åˆ’åˆ†
2. **å®Œå–„çš„ç¯å¢ƒé…ç½®**ï¼šå¤šç¯å¢ƒæ”¯æŒå’Œé…ç½®ç®¡ç†
3. **è§„èŒƒçš„ä»£ç é£æ ¼**ï¼šESLintå’ŒPrettierè‡ªåŠ¨åŒ–ä»£ç è§„èŒƒ
4. **DockeråŒ–å¼€å‘ç¯å¢ƒ**ï¼šç¡®ä¿å¼€å‘ç¯å¢ƒä¸€è‡´æ€§

### 4.2 ä¸‹ä¸€æ­¥è®¡åˆ’

- å®ç°æ•°æ®åº“æ¨¡å‹è®¾è®¡å’ŒORMé…ç½®
- æ„å»ºç”¨æˆ·è®¤è¯å’Œæƒé™ç®¡ç†ç³»ç»Ÿ
- å¼€å‘æ ¸å¿ƒä¸šåŠ¡åŠŸèƒ½æ¨¡å—

ç»§ç»­é˜…è¯»ä¸‹ä¸€ç« èŠ‚ï¼Œæ·±å…¥å­¦ä¹ æ•°æ®åº“è®¾è®¡ä¸ORMæœ€ä½³å®è·µï¼